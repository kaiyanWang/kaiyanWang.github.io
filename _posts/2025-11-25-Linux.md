---
title: Linux
tags: CS
article_header:
  type: overlay
  theme: dark
  background_color: '#203028'
  background_image:
    gradient: 'linear-gradient(135deg, rgba(34, 139, 87 , .4), rgba(139, 34, 139, .4))'
    src: /assets/images/blogs/Linux.jfif
---

<!--more-->

# 1 常用文件管理命令

`.` 当前目录

`..` 上一级目录

`~` 家目录，当前登录的用户是**root 用户（超级管理员）**，pwd的结果为/root，而普通用户**wky**，pwd的结果为/home/wky。输入以下命令即可查看当前登录用户：

```bash
whoami  # 若输出“root”，说明当前是root用户；若输出“wky”，则是普通用户
```

若想切换到普通用户`wky`的家目录：先确认系统中是否存在

```bash
id wky  # 若提示“no such user”，需先创建用户：useradd -m wky（-m会自动创建/home/wky目录）
```

```bash
su - wky  # 切换用户并自动进入/home/wky
```

1、常用命令介绍

> `ctrl+c`：取消命令，并且换行
>
> `ctrl+u`：清空本行命令
>
> `ctrl+insert`：复制；`shift+insert`：粘贴
>
> `history`：输出使用过的命令
>
> `tab`键：可以补全命令和文件名，如果补全不了快速按两下tab键，可以显示备选选项
>
> `ls`：列出当前目录下所有文件，蓝色的是文件夹，白色的是普通文件，绿色的是可执行文件
>
> `pwd`：显示当前路径
>
> `cd XXX`：进入XXX目录下，cd ..返回上层目录，cd -返回上次所在的目录
>
> `cp XXX YYY`：将XXX文件复制到YYY，YYY路径可以和XXX相同
>
> `mkdir XXX`：创建目录XXX
>
> `rm XXX`：删除普通目录，rm XXX -r：删除文件夹
>
> `mv XXX YYY`：将XXX文件移动到YYY，路径可不变，重命名也是用这个命令
>
> `touch XXX`：创建一个文件
>
> `cat XXX`：展示文件XXX中的内容
>
> `scp XXX YYY`：将本地的XXX上传到云服务器YYY路径（scp  D:\test.txt   root@39.99.43.230:/root/），从云端下载同理，注意需要该命令在本地电脑终端执行

# 2 tmux和vim

### 2.1 tmux

tmux原本的前缀键为`ctrl+b`，通过配置改为`ctrl+a`

**功能**：(1)分屏；(2)运行断开terminal连接后，继续运行进程

**结构**：一个tmux可以包含多个session，一个session可以包含多个window，一个window可以包含多个pane

**操作**：

> （1）`tmux`：新建一个session，其中包含一个window，window中包含一个pane，pane里打开了一个shell对话框
>
> （2）按下`ctrl+a`后手指松开（前缀键），然后按`%`：将当前pane左右半分为两个pane
>
> （3）按下`ctrl+a`后手指松开，然后按`"`：将当前pane上下半分为两个pane
>
> （4）`ctrl+d`：关闭当前的pane，如果当前window的所有pane均已关闭，则自动关闭window，如果当前session的所有window均已关闭，则自动关闭session
>
> （5）按下`ctrl+a`后手指松开，然后按方向键：切换窗格pane。
>
> - 鼠标切换（需开启鼠标支持）：按前缀键 `Ctrl + b` + `:`，输入 `set -g mouse on` 回车，之后可直接用鼠标点击窗格切换。
>
> （6）按下`ctrl+a`的同时按方向键：调整pane之间分割线的位置。
>
> - 鼠标拖动pane之间的分割线，可以调整pane之间分割线的位置。
>
> （7）按下`ctrl+a`后手指松开，然后按`z`：将当前pane全屏/取消全屏
>
> （8）按下`ctrl+a`后手指松开，然后按`d`：挂起当前session
>
> （9）`tmux a`：打开之前挂起的session
>
> （10）按下`ctrl+a`后手指松开，然后按`s`：选择其他session
>
> - 方向键-上：选择上一项
> - 方向键-下：选择下一项
> - 方向键-右：展开当前项
> - 方向键-左：闭合当前项
>
> （11）按下`ctrl+a`后手指松开，然后按`c`：在当前session中创建新的window
>
> （12）按下`ctrl+a`后手指松开，然后按`w`：选择其他window，操作方式同（10）
>
> （13）按下`ctrl+a`后手指松开，然后按`PageUp`（fn+方向键上）：翻阅当前pane内的内容
>
> - 鼠标滚轮：翻阅当前pane内的内容
>
> （14）在`tmux`中选择文本时，需要按住shift键，然后可以通过`ctrl+insert`和`shift+insert`复制粘贴

### 2.2 vim

**功能**：(1)命令行格式下的文本编辑器；(2)根据文件扩展名自动判别编程语言。支持代码缩进、代码高亮等功能

**模式**：

（1）一般命令模式：默认模式。命令输入方式：按不同字符，进行不同操作，可以复制、粘贴、删除文本等

（2）编辑模式：在一般命令模式里按下i，会进入编辑模式，按ESC会推出编辑模式，返回到一般命令模式

（3）命令行模式：在一般命令模式里按下`:/?`中的任意一个，会进入命令行模式。命令行在最下面，可以查找、替换、报错、退出、配置编辑器等。

**操作**：

> `vim 文件名`：如果已有该文件，打开它；如果没有，则创建
>
> `i`：进入编辑模式
>
> `ESC`：进入一般命令模式
>
> `n<Space>`：n表示数字，按下数字后再按空格，光标会向右移动这一行的n个字符
>
> `G`：光标移动到最后一行；`gg`：光标移动到第一行
>
> `:n`或`nG`：n为数字，光标移动到第n行
>
> `n<Enter>`：n为数字，光标向下移动n行
>
> `/word`：向光标之下寻找第一个值为word的字符串
>
> `?word`：向光标之上寻找第一个值为word的字符串
>
> `n`：重复前一个查找操作；`N`：反向重复前一个查找操作
>
> `:n1,n2s/word1/word2/g`：n1与n2为数字，在第n1行与n2行之间寻找word1这个字符串，并将该字符串替换为word2
>
> `:1,$s/word1/word2/g`：在第1行与最后一行之间（全文）寻找word1这个字符串，并将该字符串替换为word2
>
> `:1,$s/word1/word2/gc`：在全文寻找word1这个字符串，并将该字符串替换为word2，且在替换前要求用户确认
>
> `v`：选中文本，按两下`esc`取消选中
>
> `d`：删除选中的文本（本质是剪切）
>
> `dd`：删除当前行（本质是剪切）
>
> `y`：复制选中的文本
>
> `yy`：复制当行
>
> `p`：将复制的数据在光标的下一行/下一个位置粘贴
>
> `u`：撤销；`crtl+r`：反撤销
>
> `大于号>`：将选中的文本整体向右移动
>
> `小于号<`：将选中的文本整体向左移动
>
> `:w`：保存
>
> `:w！`：强制保存
>
> `:q`：退出
>
> `:q！`：强制退出
>
> `:wq`：保存并退出
>
> `:set paste`：设置成粘贴模式，取消代码自动缩进
>
> `:set nopaste`：取消粘贴模式，开启代码自动缩进
>
> `:set nu`：显示行号
>
> `:set nonu`：隐藏行号
>
> `gg=G`：将全文代码格式化（gg回到第一行，=格式化，G到最后一行）
>
> `ggdG`：将全文删除（gg回到第一行，d删除，G到最后一行）
>
> `:noh`： 关闭查找关键词高亮
>
> `ctrl+q`：当vim卡死时，可以取消当前正在执行的命令

# 3 shell语法

### 3.1 概论

### 3.2 注释

### 3.3 变量

### 3.4 默认变量

### 3.5 数组

### 3.6 expr命令

### 3.7 read命令

### 3.8 echo命令

### 3.9 printf命令

### 3.10 test命令与判断符号[]

### 3.11 判断语句

### 3.12 循环语句

### 3.13 函数

### 3.14 exit命令

### 3.15 文件重定向

### 3.16 引入外部脚本

# 4 ssh

### 4.1 远程登录服务器
```bash
ssh user@hostname  # user: 用户名，hostname: IP地址或域名
ssh user@hostname -p 22  # 使用-p登录某一特定端口，默认登录端口号为22
```
第一次登录时会有提示信息，输入yes，然后回车即可。这样会将该服务器的信息记录在本地的`~/.ssh/known_hosts`文件中。


### 4.2 配置别名

回到本地终端，创建文件 `~/.ssh/config`，然后在文件中输入：
```bash
Host myserver1
    HostName IP地址或域名
    User 用户名

Host myserver2
    HostName IP地址或域名
    User 用户名
```
之后再使用服务器时，可以直接使用别名`myserver1`、`myserver2`。

### 4.3 ssh密钥登录

创建密钥：
```bash
ssh-keygen
```
然后一直回车即可。执行结束后，~/.ssh/目录下会多两个文件：`id_rsa`（私钥），`id_rsa.pub`（公钥），之后想免密码登录哪个服务器，就将公钥传给哪个服务器即可。

例如，想免密登录`myserver`服务器：

**方法一**：将公钥中的内容，复制到`myserver`中的`~/.ssh/authorized_keys`文件里。

**方法二**：在本地终端使用如下命令给`myserver`一键添加公钥：
```bash
ssh-copy-id myserver
```
### 4.4 自动化场景

不用登录服务器的终端界面，直接在自己本地电脑上，发一条指令让目标服务器执行，执行结果会实时传回本地。

```bash
ssh user@hostname command  # command：替换成Linux命令，如ls等
```
日常使用省时间，自动化场景不可或缺，是远程服务器运维、开发中最常用的命令之一。

### 4.5 scp传文件

```bash
scp source destination  # 将source路径下的文件复制到destination中

scp source1 source2 destination  #一次复制多个文件

scp -r ~/tmp myserver:/home/acs/  # 将本地家目录中的tmp文件夹复制到myserver服务器中的/home/acs/目录下。

scp -r ~/tmp myserver:homework/  # 将本地家目录中的tmp文件夹复制到myserver服务器中的~/homework/目录下。

scp -r myserver:homework . # 将myserver服务器中的~/homework/文件夹复制到本地的当前路径下。

scp -P 22 source1 source2 destination  # 指定服务器的端口号。注意： scp的-r -P等参数尽量加在source和destination之前。

scp ~/.vimrc ~/.tmux.conf myserver:  # 使用scp配置其他服务器的vim和tmux
```

# 5 git

修改`commit`的时间

```bash
# 1. 重新进入变基模式，编辑该提交
git rebase -i HEAD~4  # 只针对最近4次提交（也可用id，从编号为id的commit开始修改：git rebase -i id~1，如果要从第一次提交开始修改：git rebase -i --root）
# 2. 把 pick 改成 e，保存退出
# 3. 同时修改作者时间和提交者时间
GIT_COMMITTER_DATE="2024-XX-XX 10:00:00" git commit --amend --date="2024-XX-XX 10:00:00"
# 4. 收尾变基
git rebase --continue
# 5. 重新强制推送
git push --force-with-lease origin 分支名
```

### 5.1 git基本概念

工作区：仓库的目录。工作区是独立于各个分支的。

暂存区：数据暂时存放的区域，类似于工作区写入版本库前的缓存区。暂存区是独立于各个分支的。

版本库：存放所有已经提交到本地仓库的代码版本

版本结构：树结构，树中每个节点代表一个代码版本。

### 5.2 设置ssh密钥登录

（1）在本地右键，选择`Git bash`， 进入家目录`cd ~`，生成秘钥：`ssh-keygen`

（2）进入`.ssh`隐藏文件，到公钥文件`id_rsa.pub`取出公钥

（3）点击`gitHub`右上方头像，进入`setting`-`Access`-`SSH and GPG keys`，将公钥粘贴进去

### 5.3 git常用命令
> `git config --global user.name xxx`：设置全局用户名，信息记录在`~/.gitconfig文`件中
>
> `git config --global user.email xxx@xxx.com`：设置全局邮箱地址，信息记录在`~/.gitconfig`文件中
>
> `git init`：将当前目录配置成`git`仓库，信息记录在隐藏的`.git`文件夹中
>
> `git add XX`：将XX文件添加到暂存区，`git add .`：将所有待加入暂存区的文件加入暂存区
>
> `git commit -m "给自己看的备注信息"`：将暂存区的内容提交到当前分支
>
> `git status`：查看仓库状态
>
> `git diff XX`：查看XX文件相对于暂存区修改了哪些内容
>
> `git rm --cached XX`：将文件从仓库索引目录中删掉（`git`不管理XX文件的版本），加回去用`git add XX`
>
> `git log`：查看当前分支的所有版本（根->HEAD路径上的版本）
>
> `git reflog`：查看HEAD指针的移动历史（包括被回滚的版本）
>
> `git reset --hard HEAD^` 或` git reset --hard HEAD~`：将代码库回滚到上一个版本，`git reset --hard HEAD^^`：往上回滚两次，以此类推，`git reset --hard HEAD~100`：往上回滚100个版本
>
> `git reset --hard 版本号`：回滚到某一特定版本
>
> `git remote add origin git@git.acwing.com:xxx/XXX.git`：将本地仓库关联到远程仓库
>
> `git push -u `(第一次需要-u以后不需要)：将当前分支推送到远程仓库（`-u` 是 `--set-upstream` 的缩写，核心作用是 给本地分支和远程分支建立「跟踪关系」）
>
> `git push origin branch_name`：将本地的某个分支推送到远程仓库
>
> `git clone git@git.acwing.com:xxx/XXX.git`：将远程仓库XXX下载到当前目录下
>
> `git branch branch_name`：创建新分支
>
> `git checkout branch_name`：切换到branch_name这个分支，`git checkout -b branch_name`：创建并切换到`branch_name`这个分支
>
> `git branch`：查看所有分支和当前所处分支
>
> `git merge branch_name`：将分支`branch_name`合并到当前分支上
>
> `git branch -d branch_name`：删除本地仓库的branch_name分支
>
> `git push --set-upstream origin branch_name`：设置本地的`branch_name`分支对应远程仓库的`branch_name`分支
>
> `git push -d origin branch_name`：删除远程仓库的branch_name分支
>
> `git pull`：将远程仓库的当前分支与本地仓库的当前分支合并，`git pull origin branch_name`：将远程仓库的branch_name分支与本地仓库的当前分支合并
>
> `git branch --set-upstream-to=origin/branch_name1 branch_name2`：将远程的`branch_name1`分支与本地的`branch_name2`分支对应
>
> `git checkout -t origin/branch_name `：将远程的branch_name分支拉取到本地
>
> `git stash`：将工作区和暂存区中尚未提交的修改存入栈中
>
> `git stash apply`：将栈顶存储的修改恢复到当前分支，但不删除栈顶元素
>
> `git stash drop`：删除栈顶存储的修改
>
> `git stash pop`：将栈顶存储的修改恢复到当前分支，同时删除栈顶元素
>
> `git stash list`：查看栈中所有元素

# 6 thrift

# 7 管道、环境变量与常用命令

7.1 管道

7.2 环境变量

7.3 常用命令

# 8 docker

**镜像（images）**

* `docker pull ubuntu:20.04`：拉取一个镜像

* `docker images`：列出本地所有镜像

* `docker image rm ubuntu:20.04` 或 `docker rmi ubuntu:20.04`：删除镜像ubuntu:20.04

* `docker [container] commit CONTAINER IMAGE_NAME:TAG`：创建某个container的镜像

* `docker save -o ubuntu_20_04.tar ubuntu:20.04`：将镜像`ubuntu:20.04`导出到本地文件`ubuntu_20_04.tar`中

* `docker load -i ubuntu_20_04.tar`：将镜像`ubuntu:20.04`从本地文件`ubuntu_20_04.tar`中加载出来


**容器(container)**

* `docker [container] create -it ubuntu:20.04`：利用镜像ubuntu:20.04创建一个容器。

* `docker ps -a`：查看本地的所有容器

* `docker [container] start CONTAINER`：启动容器
* `docker [container] stop CONTAINER`：停止容器
* `docker [container] restart CONTAINER`：重启容器
* `docker [contaienr] run -itd ubuntu:20.04`：创建并启动一个容器
* `docker [container] attach CONTAINER`：进入容器
先按`Ctrl-p`，再按`Ctrl-q`可以挂起容器
* `docker [container] exec CONTAINER COMMAND`：在容器中执行命令
* `docker [container] rm CONTAINER`：删除容器
* `docker container prune`：删除所有已停止的容器
* `docker export -o xxx.tar CONTAINER`：将容器CONTAINER导出到本地文件xxx.tar中
* `docker import xxx.tar image_name:tag`：将本地文件xxx.tar导入成镜像，并将镜像命名为`image_name:tag`
* `docker export/import`与`docker save/load`的区别：`export/import`会丢弃历史记录和元数据信息，仅保存容器当时的快照状态
`save/load会`保存完整记录，体积更大
* `docker top CONTAINER`：查看某个容器内的所有进程
* `docker stats`：查看所有容器的统计信息，包括CPU、内存、存储、网络等信息
* `docker cp xxx CONTAINER:xxx` 或 `docker cp CONTAINER:xxx xxx`：在本地和容器间复制文件
* `docker rename CONTAINER1 CONTAINER2`：重命名容器
* `docker update CONTAINER --memory 500MB`：修改容器限制

